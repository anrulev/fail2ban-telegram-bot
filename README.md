# Fail2Ban Telegram Bot

![–Ø–∑—ã–∫-–†—É—Å—Å–∫–∏–π](https://img.shields.io/badge/%D0%AF%D0%B7%D1%8B%D0%BA-%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9-lightgrey?logo=google-translate&style=flat) [![Language-English](https://img.shields.io/badge/Language-English-blue?logo=google-translate&style=flat)](README.en.md)

–ë–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Fail2Ban –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö –≤ Telegram.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥-—Ñ–∞–π–ª–∞ Fail2Ban –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üö® –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö –≤ Telegram
- üìä –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ Fail2Ban
- üîí –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö "—Ç—é—Ä—å–º–∞—Ö" (jails)
- üê≥ –†–∞–±–æ—Ç–∞–µ—Ç –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- üß± –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å—Ç–∞—Ç—É—Å–∞ (—Ç—Ä–µ–±—É—é—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ `fail2ban-client`): –≤–∫–ª—é—á–∞—é—Ç—Å—è —Ñ–ª–∞–≥–æ–º `ENABLE_FAIL2BAN_STATUS=true`

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
- Fail2Ban, —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ
- –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –∏ ID —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Telegram –±–æ—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather):
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot` –±–æ—Ç—É @BotFather
   - –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ `123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ`)

2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ ID —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   - –î–ª—è –ª–∏—á–Ω–æ–≥–æ —á–∞—Ç–∞: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É [@userinfobot](https://t.me/userinfobot) –∏ –ø–æ–ª—É—á–∏—Ç–µ –≤–∞—à ID
   - –î–ª—è –≥—Ä—É–ø–ø—ã: –¥–æ–±–∞–≤—å—Ç–µ [@RawDataBot](https://t.me/RawDataBot) –≤ –≥—Ä—É–ø–ø—É –∏ –Ω–∞–π–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `"chat":{"id":`

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/anrulev/fail2ban-telegram-bot.git
cd fail2ban-telegram-bot
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env`, —É–∫–∞–∑–∞–≤ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ ID —á–∞—Ç–∞:

```
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here
CHECK_INTERVAL=60
MAX_ALERTS_PER_RUN=10
# –í–∫–ª—é—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã /status –∏ /jails, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω fail2ban-client
ENABLE_FAIL2BAN_STATUS=false
```

### 4. –ó–∞–ø—É—Å–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∫—Ä–∏–ø—Ç–∞

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `run.sh`:

```bash
chmod +x run.sh
./run.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `.env`, —Å–æ–∑–¥–∞—Å—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

### 5. –ó–∞–ø—É—Å–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker Compose –≤—Ä—É—á–Ω—É—é

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p logs
chmod 755 logs

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose up -d --build
```

### 6. –ó–∞–ø—É—Å–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker –Ω–∞–ø—Ä—è–º—É—é

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t fail2ban-telegram-bot .

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p logs
chmod 755 logs

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d \
  --name fail2ban-telegram-bot \
  --restart unless-stopped \
  -v /var/log/fail2ban.log:/var/log/fail2ban.log:ro \
  -v $(pwd)/logs:/app/logs \
  -e TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here \
  -e TELEGRAM_CHAT_ID=your_chat_id_here \
  -e FAIL2BAN_LOG_FILE=/var/log/fail2ban.log \
  -e CHECK_INTERVAL=60 \
  -e MAX_ALERTS_PER_RUN=10 \
  -e ENABLE_FAIL2BAN_STATUS=false \
  fail2ban-telegram-bot
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥-—Ñ–∞–π–ª Fail2Ban –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —á–∞—Ç.

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` –∏–ª–∏ `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- `/status` - –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å Fail2Ban (–µ—Å–ª–∏ `ENABLE_FAIL2BAN_STATUS=true` –∏ –¥–æ—Å—Ç—É–ø–µ–Ω `fail2ban-client`)
- `/jails` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö "—Ç—é—Ä–µ–º" (–µ—Å–ª–∏ `ENABLE_FAIL2BAN_STATUS=true` –∏ –¥–æ—Å—Ç—É–ø–µ–Ω `fail2ban-client`)
- `/latest` - –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start` –±–æ—Ç—É –≤ Telegram
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
   ```bash
   docker logs fail2ban-telegram-bot
   ```
3. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫–æ–π-–ª–∏–±–æ IP —á–µ—Ä–µ–∑ Fail2Ban:
   ```bash
   sudo fail2ban-client set sshd banip 192.168.1.100
   ```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose down

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
git pull

# –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose up -d --build
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ ID —á–∞—Ç–∞ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥-—Ñ–∞–π–ª—É Fail2Ban
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫:
  ```bash
  docker logs fail2ban-telegram-bot
  ```

### –í–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ /status –∏ /jails

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã. –ß—Ç–æ–±—ã –∏—Ö –≤–∫–ª—é—á–∏—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `ENABLE_FAIL2BAN_STATUS=true` –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–æ–∫–µ—Ç Fail2Ban –∏–∑ —Ö–æ—Å—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤—å—Ç–µ –≤ –æ–±—Ä–∞–∑ –∫–ª–∏–µ–Ω—Ç:

1) (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ) –†–∞—Å—à–∏—Ä—å—Ç–µ –æ–±—Ä–∞–∑ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `fail2ban-client` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```dockerfile
# Dockerfile.status
FROM fail2ban-telegram-bot:latest
USER root
RUN apt-get update \
    && apt-get install -y --no-install-recommends fail2ban \
    && rm -rf /var/lib/apt/lists/*
USER botuser
```

–°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤ docker-compose –≤–º–µ—Å—Ç–æ –±–∞–∑–æ–≤–æ–≥–æ.

2) –°–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–æ–∫–µ—Ç `fail2ban` –∏ –≤–∫–ª—é—á–∏—Ç–µ —Ñ–ª–∞–≥:

```yaml
services:
  fail2ban-bot:
    # image: –≤–∞—à-—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π-–æ–±—Ä–∞–∑
    environment:
      - ENABLE_FAIL2BAN_STATUS=true
    volumes:
      - /var/run/fail2ban/fail2ban.sock:/var/run/fail2ban/fail2ban.sock:ro
```

–ë–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–∫–µ—Ç—É –∏ –Ω–∞–ª–∏—á–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∫–æ–º–∞–Ω–¥—ã `/status` –∏ `/jails` —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥—É—Ç.

### –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥-—Ñ–∞–π–ª—É

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—É—â–µ–Ω Docker, –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–∞ Fail2Ban:

```bash
sudo chmod a+r /var/log/fail2ban.log
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É, –∏–º–µ—é—â—É—é –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É:

```bash
# –£–∑–Ω–∞—Ç—å –≥—Ä—É–ø–ø—É —Ñ–∞–π–ª–∞
ls -l /var/log/fail2ban.log

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É
sudo usermod -a -G –∏–º—è_–≥—Ä—É–ø–ø—ã $(whoami)
```

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Docker:

```bash
docker logs fail2ban-telegram-bot
```

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ä–µ–∂–∏–º–æ–º (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞):

```bash
docker-compose down
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml`, –¥–æ–±–∞–≤–∏–≤:

```yaml
services:
  fail2ban-bot:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...
    privileged: true
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞:

```bash
docker-compose up -d
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT 